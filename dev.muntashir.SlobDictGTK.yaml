app-id: dev.muntashir.SlobDictGTK
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: slobdict
finish-args:
  - --share=network
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  # Add explicit GTK theme access for KDE
  - --filesystem=xdg-config/gtk-4.0:ro
  - --filesystem=xdg-config/gtkrc-2.0:ro
  # For D-Bus
  - --own-name=dev.muntashir.SlobDictGTK
  - --own-name=dev.muntashir.SlobDictGTK.*
build-options:
  build-args:
    - --share=network
modules:
  - name: icu
    buildsystem: autotools
    config-opts:
      - --disable-samples
      - --disable-tests
      - --enable-shared
      - --disable-static
      - --prefix=/app
    cleanup:
      - /bin
      - /include
      - /share
      - /lib/*.a
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://github.com/unicode-org/icu/releases/download/release-78.1/icu4c-78.1-sources.tgz
        sha256: 6217f58ca39b23127605cfc6c7e0d3475fe4b0d63157011383d716cb41617886
    subdir: source

  - name: lzo
    config-opts:
      - --enable-shared
      - --disable-static
    cleanup:
      - /include
      - /share/doc
      - '*.la'
      - /lib/*.so
    sources:
      - type: archive
        url: https://www.oberhumer.com/opensource/lzo/download/lzo-2.10.tar.gz
        sha256: c0f892943208266f9b6543b3ae308fab6284c5c90e627931446fb49b4221a072
        x-checker-data:
          type: anitya
          project-id: 1868
          url-template: https://www.oberhumer.com/opensource/lzo/download/lzo-$version.tar.gz

  - name: xapian-core
    config-opts:
      - --disable-sse
      - --disable-backend-chert
      - --disable-backend-remote
      - --disable-documentation
    sources:
      - type: archive
        sha256: bcbc99cfbf16080119c2571fc296794f539bd542ca3926f17c2999600830ab61
        url: https://oligarchy.co.uk/xapian/1.4.27/xapian-core-1.4.27.tar.xz
        x-checker-data:
          type: anitya
          project-id: 15919
          url-template: https://oligarchy.co.uk/xapian/$version/xapian-core-$version.tar.xz

  - name: libzim
    buildsystem: meson
    builddir: true
    config-opts:
      - --wrap-mode=nodownload
      - -Dtest_data_dir=none
    build-options:
      env:
        LDFLAGS: "-L/app/lib -licui18n -licuuc -licudata"
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/openzim/libzim.git
        tag: 9.2.3
        commit: 398a3c25059ee0ec7e2987d6af336d67dd681ba1
        x-checker-data:
          type: anitya
          project-id: 20193
          tag-template: $version

  - name: python3-modules
    buildsystem: simple
    build-commands: []
    modules:
      - python3-modules.json
    sources:
      - type: file
        path: python3-modules.json

  - name: blueprint-compiler
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/jwestman/blueprint-compiler
        tag: v0.16.0

  - name: dev.muntashir.SlobDictGTK
    builddir: true
    buildsystem: meson
    config-opts:
      - -Dbuildtype=release
    sources:
      - type: dir
        path: .
    post-install:
      - chmod +x /app/bin/slobdict
